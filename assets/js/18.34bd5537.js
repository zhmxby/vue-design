(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{65:function(t,s,n){"use strict";n.r(s);var a=n(0),e=Object(a.a)({},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("div",{staticClass:"content"},[t._m(0),t._m(1),t._m(2),n("p",[t._v("在 "),n("router-link",{attrs:{to:"./1start-learn.html"}},[t._v("了解 Vue 这个项目")]),t._v(" 一节中，我们在最后提到这套文章将会以 "),n("code",[t._v("npm run dev")]),t._v(" 为切入点：")],1),t._m(3),t._m(4),t._m(5),t._m(6),t._m(7),t._m(8),n("p",[t._v("其中有这么一句：")]),t._m(9),t._m(10),t._m(11),t._m(12),t._m(13),t._m(14),t._m(15),t._m(16),t._m(17),t._m(18),t._m(19),t._m(20),t._m(21),t._m(22),t._m(23),t._m(24),t._m(25),t._m(26),t._m(27),t._m(28),t._m(29),t._m(30),t._m(31),t._m(32),t._m(33),t._m(34),t._m(35),t._m(36),t._m(37),t._m(38),t._m(39),t._m(40),t._m(41),t._m(42),t._m(43),n("p",[t._v("至此，"),n("code",[t._v("instance/index.js")]),t._v(" 文件中的代码就运行完毕了（注意：所谓的运行，是指执行 "),n("code",[t._v("npm run dev")]),t._v(" 命令时构建的运行）。我们大概清楚每个 "),n("code",[t._v("*Mixin")]),t._v(" 方法的作用其实就是包装 "),n("code",[t._v("Vue.prototype")]),t._v("，在其上挂载一些属性和方法，下面我们要做一件很重要的事情，就是将上面的内容集中合并起来，放到一个单独的地方，便于以后查看，我将它们整理到了这里："),n("router-link",{attrs:{to:"../appendix/vue-prototype.html"}},[t._v("附录/Vue 构造函数整理-原型")]),t._v("，这样当我们在后面详细讲解的时候，提到某个方法你就可以迅速定位它的位置，便于我们思路的清晰。")],1),t._m(44),t._m(45),t._m(46),t._m(47),t._m(48),t._m(49),t._m(50),t._m(51),t._m(52),n("p",[t._v("我们在回过头来看看这句话：")]),t._m(53),t._m(54),n("p",[t._v("首先是这样一段代码：")]),t._m(55),t._m(56),t._m(57),t._m(58),t._m(59),n("p",[t._v("接着是这样一段代码：")]),t._m(60),t._m(61),t._m(62),n("p",[t._v("然后是这样一段代码：")]),t._m(63),t._m(64),t._m(65),t._m(66),t._m(67),t._m(68),n("p",[t._v("所以当下面这段代码执行完后：")]),t._m(69),t._m(70),t._m(71),n("p",[t._v("紧接着，是这句代码：")]),t._m(72),n("p",[n("code",[t._v("extend")]),t._v(" 来自于 "),n("code",[t._v("shared/util.js")]),t._v(" 文件，可以在 "),n("router-link",{attrs:{to:"../appendix/shared-util.html"}},[t._v("附录/shared/util.js 文件工具方法全解")]),t._v(" 中查看其作用，总之这句话的意思就是将 "),n("code",[t._v("builtInComponents")]),t._v(" 的属性混合到 "),n("code",[t._v("Vue.options.components")]),t._v(" 中，其中 "),n("code",[t._v("builtInComponents")]),t._v(" 来自于 "),n("code",[t._v("core/components/index.js")]),t._v(" 文件，该文件如下：")],1),t._m(73),t._m(74),t._m(75),t._m(76),t._m(77),t._m(78),t._m(79),t._m(80),t._m(81),t._m(82),t._m(83),t._m(84),t._m(85),t._m(86),t._m(87),t._m(88),t._m(89),t._m(90),t._m(91),t._m(92),t._m(93),t._m(94),n("p",[t._v("这三个静态方法大家都不陌生，分别用来全局注册组件，指令和过滤器。")]),n("p",[t._v("这样，"),n("code",[t._v("initGlobalAPI")]),t._v(" 方法的全部功能我们就介绍完毕了，它的作用就像它的名字一样，是在 "),n("code",[t._v("Vue")]),t._v(" 构造函数上添加全局的API，类似整理 "),n("code",[t._v("Vue.prototype")]),t._v(" 上的属性和方法一样，我们同样对 "),n("code",[t._v("Vue")]),t._v(" 静态属性和方法做一个整理，将他放到 "),n("router-link",{attrs:{to:"../appendix/vue-global-api.html"}},[t._v("附录/Vue 构造函数整理-全局API")]),t._v(" 中，便于以后查阅。")],1),t._m(95),t._m(96),t._m(97),t._m(98),t._m(99),t._m(100),t._m(101),t._m(102),t._m(103),t._m(104),t._m(105),t._m(106),t._m(107),t._m(108),n("p",[t._v("接着是这两句代码：")]),t._m(109),t._m(110),t._m(111),n("p",[n("code",[t._v("extend")]),t._v(" 方法我们见过，这里就不说明其作用了，可以查看 "),n("router-link",{attrs:{to:"../appendix/shared-util.html"}},[t._v("附录/shared/util.js 文件工具方法全解")]),t._v("，那么经过这两句代码之后的 "),n("code",[t._v("Vue.options")]),t._v(" 长什么样呢？要想知道这个问题，我们就要知道 "),n("code",[t._v("platformDirectives")]),t._v(" 和 "),n("code",[t._v("platformComponents")]),t._v(" 长什么样。")],1),t._m(112),t._m(113),t._m(114),t._m(115),t._m(116),t._m(117),n("p",[t._v("所以，经过：")]),t._m(118),t._m(119),t._m(120),t._m(121),t._m(122),t._m(123),t._m(124),n("p",[t._v("那么经过：")]),t._m(125),t._m(126),t._m(127),t._m(128),n("p",[t._v("我们继续往下看代码，接下来是这段：")]),t._m(129),t._m(130),t._m(131),t._m(132),t._m(133),t._m(134),t._m(135),t._m(136),t._m(137),t._m(138),t._m(139),t._m(140),t._m(141),t._m(142),t._m(143),t._m(144),t._m(145)])},[function(){var t=this.$createElement,s=this._self._c||t;return s("h1",{attrs:{id:"vue-构造函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vue-构造函数","aria-hidden":"true"}},[this._v("#")]),this._v(" Vue 构造函数")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("我们知道，我们在使用 "),n("code",[t._v("Vue")]),t._v(" 的时候，要使用 "),n("code",[t._v("new")]),t._v(" 操作符进行调用，这说明 "),n("code",[t._v("Vue")]),t._v(" 应该是一个构造函数，所以我们要做的第一件事就是：把 "),n("code",[t._v("Vue")]),t._v(" 构造函数搞清楚。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"vue-构造函数的原型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vue-构造函数的原型","aria-hidden":"true"}},[this._v("#")]),this._v(" Vue 构造函数的原型")])},function(){var t=this.$createElement,s=this._self._c||t;return s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token string"}},[this._v('"dev"')]),s("span",{attrs:{class:"token punctuation"}},[this._v(":")]),this._v(" "),s("span",{attrs:{class:"token string"}},[this._v('"rollup -w -c scripts/config.js --environment TARGET:web-full-dev"')]),s("span",{attrs:{class:"token punctuation"}},[this._v(",")]),this._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("当我们执行 "),s("code",[this._v("npm run dev")]),this._v(" 时，根据 "),s("code",[this._v("scripts/config.js")]),this._v(" 文件中的配置：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// Runtime+compiler development build (Browser)")]),t._v("\n  "),n("span",{attrs:{class:"token string"}},[t._v("'web-full-dev'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    entry"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("resolve")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'web/entry-runtime-with-compiler.js'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    dest"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("resolve")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'dist/vue.js'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    format"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'umd'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    env"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'development'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    alias"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" he"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./entity-decoder'")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    banner\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("可知，入口文件为 "),n("code",[t._v("web/entry-runtime-with-compiler.js")]),t._v("，最终输出 "),n("code",[t._v("dist/vue.js")]),t._v("，它是一个 "),n("code",[t._v("umd")]),t._v(" 模块，接下来我们就以入口文件为起点，找到 "),n("code",[t._v("Vue")]),t._v(" 构造函数并将 "),n("code",[t._v("Vue")]),t._v(" 构造函数的真面目扒的一清二楚。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("但现在有一个问题 "),s("code",[this._v("web/entry-runtime-with-compiler.js")]),this._v(" 中这个 "),s("code",[this._v("web")]),this._v(" 指的是哪一个目录？这其实是一个别名配置，打开 "),s("code",[this._v("scripts/alias.js")]),this._v(" 文件：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" path "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("require")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'path'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{attrs:{class:"token function-variable function"}},[t._v("resolve")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" p "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" path"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("resolve")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("__dirname"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'../'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" p"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nmodule"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("exports "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("resolve")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'src/platforms/web/entry-runtime-with-compiler'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  compiler"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("resolve")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'src/compiler'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  core"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("resolve")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'src/core'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  shared"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("resolve")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'src/shared'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  web"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("resolve")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'src/platforms/web'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  weex"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("resolve")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'src/platforms/weex'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  server"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("resolve")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'src/server'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  entries"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("resolve")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'src/entries'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  sfc"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("resolve")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'src/sfc'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("web"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("resolve")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'src/platforms/web'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("所以 "),n("code",[t._v("web")]),t._v(" 指向的应该是 "),n("code",[t._v("src/platforms/web")]),t._v("，除了 "),n("code",[t._v("web")]),t._v(" 之外，"),n("code",[t._v("alias.js")]),t._v(" 文件中还配置了其他的别名，大家在找对应目录的时候，可以来这里查阅，后面就不做这种目录寻找的说明了。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("接下来我们就进入正题，打开 "),s("code",[this._v("src/platforms/web/entry-runtime-with-compiler.js")]),this._v(" 文件，你可以看到这样一句话：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[this._v("import")]),this._v(" Vue "),s("span",{attrs:{class:"token keyword"}},[this._v("from")]),this._v(" "),s("span",{attrs:{class:"token string"}},[this._v("'./runtime/index'")]),this._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("这说明：这个文件并不是 Vue 构造函数的“出生地”，这个文件中的 "),n("code",[t._v("Vue")]),t._v(" 是从 "),n("code",[t._v("./runtime/index")]),t._v(" 导入进来的，于是我们就打开当前目录的 "),n("code",[t._v("runtime")]),t._v(" 目录下的 "),n("code",[t._v("index.js")]),t._v(" 看一下，你同样能够发现这样一句话：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[this._v("import")]),this._v(" Vue "),s("span",{attrs:{class:"token keyword"}},[this._v("from")]),this._v(" "),s("span",{attrs:{class:"token string"}},[this._v("'core/index'")]),this._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("同样的道理，这说明 "),n("code",[t._v("runtime/index.js")]),t._v(" 文件也不是 "),n("code",[t._v("Vue")]),t._v(" 的“出生地”，你应该继续顺藤摸瓜打开 "),n("code",[t._v("core/index.js")]),t._v(" 文件，在 "),n("code",[t._v("scripts/alias.js")]),t._v(" 的配置中，"),n("code",[t._v("core")]),t._v(" 指向的是 "),n("code",[t._v("src/core")]),t._v("，打开 "),n("code",[t._v("src/core/index.js")]),t._v(" 你能看到这样一句：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[this._v("import")]),this._v(" Vue "),s("span",{attrs:{class:"token keyword"}},[this._v("from")]),this._v(" "),s("span",{attrs:{class:"token string"}},[this._v("'./instance/index'")]),this._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("按照之前的套路，继续打开 "),s("code",[this._v("./instance/index.js")]),this._v(" 文件：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// 从五个文件导入五个方法（不包括 warn）")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" initMixin "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./init'")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" stateMixin "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./state'")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" renderMixin "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./render'")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" eventsMixin "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./events'")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" lifecycleMixin "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./lifecycle'")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" warn "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'../util/index'")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("// 定义 Vue 构造函数")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("Vue")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token constant"}},[t._v("NODE_ENV")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'production'")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n    "),n("span",{attrs:{class:"token operator"}},[t._v("!")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("Vue")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("warn")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'Vue is a constructor and should be called with the `new` keyword'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("_init")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("// 将 Vue 作为参数传递给导入的五个方法")]),t._v("\n"),n("span",{attrs:{class:"token function"}},[t._v("initMixin")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token function"}},[t._v("stateMixin")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token function"}},[t._v("eventsMixin")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token function"}},[t._v("lifecycleMixin")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token function"}},[t._v("renderMixin")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("// 导出 Vue")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v(" Vue\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("可以看到，这个文件才是 "),n("code",[t._v("Vue")]),t._v(" 构造函数真正的“出生地”，上面的代码是 "),n("code",[t._v("./instance/index.js")]),t._v(" 文件中全部的代码，还是比较简短易看的，首先分别从 "),n("code",[t._v("./init.js")]),t._v("、"),n("code",[t._v("./state.js")]),t._v("、"),n("code",[t._v("./render.js")]),t._v("、"),n("code",[t._v("./events.js")]),t._v("、"),n("code",[t._v("./lifecycle.js")]),t._v(" 这五个文件中导入五个方法，分别是："),n("code",[t._v("initMixin")]),t._v("、"),n("code",[t._v("stateMixin")]),t._v("、"),n("code",[t._v("renderMixin")]),t._v("、"),n("code",[t._v("eventsMixin")]),t._v(" 以及 "),n("code",[t._v("lifecycleMixin")]),t._v("，然后定义了 "),n("code",[t._v("Vue")]),t._v(" 构造函数，其中使用了安全模式来提醒你要使用 "),n("code",[t._v("new")]),t._v(" 操作符来调用 "),n("code",[t._v("Vue")]),t._v("，接着将 "),n("code",[t._v("Vue")]),t._v(" 构造函数作为参数，分别传递给了导入进来的这五个方法，最后导出 "),n("code",[t._v("Vue")]),t._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("那么这五个方法又做了什么呢？先看看 "),s("code",[this._v("initMixin")]),this._v(" ，打开 "),s("code",[this._v("./init.js")]),this._v(" 文件，找到 "),s("code",[this._v("initMixin")]),this._v(" 方法，如下：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("initMixin")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Class"),n("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("Component"),n("span",{attrs:{class:"token operator"}},[t._v(">")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("_init")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),n("span",{attrs:{class:"token operator"}},[t._v("?")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// ... _init 方法的函数体，此处省略")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("这个方法的作用就是在 "),n("code",[t._v("Vue")]),t._v(" 的原型上添加了 "),n("code",[t._v("_init")]),t._v(" 方法，这个 "),n("code",[t._v("_init")]),t._v(" 方法看上去应该是内部初始化的一个方法，其实在 "),n("code",[t._v("instance/index.js")]),t._v(" 文件中我们是见过这个方法的，如下：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// 定义 Vue 构造函数")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("Vue")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token constant"}},[t._v("NODE_ENV")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'production'")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v("\n    "),n("span",{attrs:{class:"token operator"}},[t._v("!")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("instanceof")]),t._v(" "),n("span",{attrs:{class:"token class-name"}},[t._v("Vue")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token function"}},[t._v("warn")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'Vue is a constructor and should be called with the `new` keyword'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// 在这里")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("_init")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("options"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("在 "),n("code",[t._v("Vue")]),t._v(" 的构造函数里有这么一句："),n("code",[t._v("this._init(options)")]),t._v("，这说明，当我们执行 "),n("code",[t._v("new Vue()")]),t._v(" 的时候，"),n("code",[t._v("this._init(options)")]),t._v(" 将被执行。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("再打开 "),s("code",[this._v("./state.js")]),this._v(" 文件，找到 "),s("code",[this._v("stateMixin")]),this._v(" 方法，这个方法的一开始，是这样一段代码：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("  "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" dataDef "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  dataDef"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("get")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_data "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" propsDef "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  propsDef"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("get")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_props "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token constant"}},[t._v("NODE_ENV")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'production'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    dataDef"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("set")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("newData"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{attrs:{class:"token function"}},[t._v("warn")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),n("span",{attrs:{class:"token string"}},[t._v("'Avoid replacing instance root $data. '")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v("\n        "),n("span",{attrs:{class:"token string"}},[t._v("'Use nested data properties instead.'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n        "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),t._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    propsDef"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("set")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{attrs:{class:"token function"}},[t._v("warn")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token template-string"}},[n("span",{attrs:{class:"token string"}},[t._v("`$props is readonly.`")])]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  Object"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("defineProperty")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'$data'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" dataDef"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  Object"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("defineProperty")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'$props'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" propsDef"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("我们先看最后两句，使用 "),n("code",[t._v("Object.defineProperty")]),t._v(" 在 "),n("code",[t._v("Vue.prototype")]),t._v(" 上定义了两个属性，就是大家熟悉的："),n("code",[t._v("$data")]),t._v(" 和 "),n("code",[t._v("$props")]),t._v("，这两个属性的定义分别写在了 "),n("code",[t._v("dataDef")]),t._v(" 以及 "),n("code",[t._v("propsDef")]),t._v(" 这两个对象里，我们来仔细看一下这两个对象的定义，首先是 "),n("code",[t._v("get")]),t._v(" ：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" dataDef "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\ndataDef"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("get")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_data "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" propsDef "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\npropsDef"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("get")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_props "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("可以看到，"),n("code",[t._v("$data")]),t._v(" 属性实际上代理的是 "),n("code",[t._v("_data")]),t._v(" 这个实例属性，而 "),n("code",[t._v("$props")]),t._v(" 代理的是 "),n("code",[t._v("_props")]),t._v(" 这个实例属性。然后有一个是否为生产环境的判断，如果不是生产环境的话，就为 "),n("code",[t._v("$data")]),t._v(" 和 "),n("code",[t._v("$props")]),t._v(" 这两个属性设置一下 "),n("code",[t._v("set")]),t._v("，实际上就是提示你一下：别他娘的想修改我，老子无敌。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("也就是说，"),s("code",[this._v("$data")]),this._v(" 和 "),s("code",[this._v("$props")]),this._v(" 是两个只读的属性，所以，现在让你使用 "),s("code",[this._v("js")]),this._v(" 实现一个只读的属性，你应该知道要怎么做了。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("接下来 "),s("code",[this._v("stateMixin")]),this._v(" 又在 "),s("code",[this._v("Vue.prototype")]),this._v(" 上定义了三个方法：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("  Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$"),n("span",{attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("set")]),t._v("\n  Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$"),n("span",{attrs:{class:"token keyword"}},[t._v("delete")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" del\n\n  Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("$watch")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n    expOrFn"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string "),n("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Function"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    cb"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" any"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    options"),n("span",{attrs:{class:"token operator"}},[t._v("?")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Function "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  \t"),n("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("这三个方法分别是："),s("code",[this._v("$set")]),this._v("、"),s("code",[this._v("$delete")]),this._v(" 以及 "),s("code",[this._v("$watch")]),this._v("，实际上这些东西你都见过的，在这里：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"http://ovjvjtt4l.bkt.clouddn.com/2017-09-04-093014.jpg",alt:""}})])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("然后是 "),n("code",[t._v("eventsMixin")]),t._v(" 方法，这个方法在 "),n("code",[t._v("./events.js")]),t._v(" 文件中，打开这个文件找到 "),n("code",[t._v("eventsMixin")]),t._v(" 方法，这个方法在 "),n("code",[t._v("Vue.prototype")]),t._v(" 上添加了四个方法，分别是：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("$on")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string "),n("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Array"),n("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("string"),n("span",{attrs:{class:"token operator"}},[t._v(">")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fn"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Function"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Component "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("$once")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fn"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Function"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Component "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("$off")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{attrs:{class:"token operator"}},[t._v("?")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string "),n("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Array"),n("span",{attrs:{class:"token operator"}},[t._v("<")]),t._v("string"),n("span",{attrs:{class:"token operator"}},[t._v(">")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" fn"),n("span",{attrs:{class:"token operator"}},[t._v("?")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Function"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Component "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("$emit")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("event"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Component "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("下一个是 "),s("code",[this._v("lifecycleMixin")]),this._v("，打开 "),s("code",[this._v("./lifecycle.js")]),this._v(" 文件找到相应方法，这个方法在 "),s("code",[this._v("Vue.prototype")]),this._v(" 上添加了三个方法：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("_update")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("vnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VNode"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" hydrating"),n("span",{attrs:{class:"token operator"}},[t._v("?")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" boolean"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("$forceUpdate")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("$destroy")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("最后一个就是 "),n("code",[t._v("renderMixin")]),t._v(" 方法了，它在 "),n("code",[t._v("render.js")]),t._v(" 文件中，这个方法的一开始以 "),n("code",[t._v("Vue.prototype")]),t._v(" 为参数调用了 "),n("code",[t._v("installRenderHelpers")]),t._v(" 函数，这个函数来自于与 "),n("code",[t._v("render.js")]),t._v(" 文件相同目录下的 "),n("code",[t._v("render-helpers/index.js")]),t._v(" 文件，打开这个文件找到 "),n("code",[t._v("installRenderHelpers")]),t._v(" 函数：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("installRenderHelpers")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("target"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" any"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  target"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_o "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" markOnce\n  target"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_n "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" toNumber\n  target"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_s "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" toString\n  target"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_l "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" renderList\n  target"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_t "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" renderSlot\n  target"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_q "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" looseEqual\n  target"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_i "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" looseIndexOf\n  target"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_m "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" renderStatic\n  target"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_f "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" resolveFilter\n  target"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_k "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" checkKeyCodes\n  target"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_b "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" bindObjectProps\n  target"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_v "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" createTextVNode\n  target"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_e "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" createEmptyVNode\n  target"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_u "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" resolveScopedSlots\n  target"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_g "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" bindObjectListeners\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("以上代码就是 "),s("code",[this._v("installRenderHelpers")]),this._v(" 函数的源码，可以发现，这个函数的作用就是在 "),s("code",[this._v("Vue.prototype")]),this._v(" 上添加一系列方法的，那么这些方法的作用大家还不需要关心，后面都会讲解到。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[n("code",[t._v("renderMixin")]),t._v(" 方法在执行完 "),n("code",[t._v("installRenderHelpers")]),t._v(" 函数之后，又在 "),n("code",[t._v("Vue.prototype")]),t._v(" 上添加了两个方法，分别是："),n("code",[t._v("$nextTick")]),t._v(" 和 "),n("code",[t._v("_render")]),t._v("，最终经过 "),n("code",[t._v("renderMixin")]),t._v(" 之后，"),n("code",[t._v("Vue.prototype")]),t._v(" 将又被添加了如下方法：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// installRenderHelpers 函数中")]),t._v("\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_o "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" markOnce\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_n "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" toNumber\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_s "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" toString\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_l "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" renderList\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_t "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" renderSlot\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_q "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" looseEqual\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_i "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" looseIndexOf\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_m "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" renderStatic\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_f "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" resolveFilter\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_k "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" checkKeyCodes\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_b "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" bindObjectProps\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_v "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" createTextVNode\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_e "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" createEmptyVNode\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_u "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" resolveScopedSlots\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_g "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" bindObjectListeners\n\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("$nextTick")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("fn"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Function"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("_render")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" VNode "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"vue-构造函数的静态属性和方法（全局api）"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vue-构造函数的静态属性和方法（全局api）","aria-hidden":"true"}},[this._v("#")]),this._v(" Vue 构造函数的静态属性和方法（全局API）")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("到目前为止，"),n("code",[t._v("core/instance/index.js")]),t._v(" 文件，也就是 "),n("code",[t._v("Vue")]),t._v(" 的出生文件的代码我们就看完了，按照之前我们寻找Vue构造函数时的文件路径回溯，下一个我们要看的文件应该就是 "),n("code",[t._v("core/index.js")]),t._v(" 文件，这个文件将 "),n("code",[t._v("Vue")]),t._v(" 从 "),n("code",[t._v("core/instance/index.js")]),t._v(" 文件中导入了进来，我们打开 "),n("code",[t._v("core/index.js")]),t._v(" 文件，下面是其全部的代码，同样很简短易看：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// 从 Vue 的出生文件导入 Vue")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Vue "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./instance/index'")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" initGlobalAPI "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./global-api/index'")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" isServerRendering "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'core/util/env'")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" FunctionalRenderContext "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'core/vdom/create-functional-component'")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("// 将 Vue 构造函数作为参数，传递给 initGlobalAPI 方法，该方法来自 ./global-api/index.js 文件")]),t._v("\n"),n("span",{attrs:{class:"token function"}},[t._v("initGlobalAPI")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("// 在 Vue.prototype 上添加 $isServer 属性，该属性代理了来自 core/util/env.js 文件的 isServerRendering 方法")]),t._v("\nObject"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("defineProperty")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'$isServer'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("get")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" isServerRendering\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("// 在 Vue.prototype 上添加 $ssrContext 属性")]),t._v("\nObject"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("defineProperty")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'$ssrContext'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("get")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("/* istanbul ignore next */")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$vnode "),n("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$vnode"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("ssrContext\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("// expose FunctionalRenderContext for ssr runtime helper installation")]),t._v("\nObject"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("defineProperty")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'FunctionalRenderContext'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  value"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" FunctionalRenderContext\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("// Vue.version 存储了当前 Vue 的版本号")]),t._v("\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("version "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'__VERSION__'")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("// 导出 Vue")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v(" Vue\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("上面的代码中，首先从 "),s("code",[this._v("Vue")]),this._v(" 的出生文件，也就是 "),s("code",[this._v("instance/index.js")]),this._v(" 文件导入 "),s("code",[this._v("Vue")]),this._v("，然后分别从三个文件导入了三个变量，如下：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" initGlobalAPI "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./global-api/index'")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" isServerRendering "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'core/util/env'")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" FunctionalRenderContext "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'core/vdom/create-functional-component'")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("其中 "),s("code",[this._v("initGlobalAPI")]),this._v(" 是一个函数，并且以 "),s("code",[this._v("Vue")]),this._v(" 构造函数作为参数进行调用：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("initGlobalAPI")]),s("span",{attrs:{class:"token punctuation"}},[this._v("(")]),this._v("Vue"),s("span",{attrs:{class:"token punctuation"}},[this._v(")")]),this._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("然后在 "),n("code",[t._v("Vue.prototype")]),t._v(" 上分别添加了两个只读的属性，分别是："),n("code",[t._v("$isServer")]),t._v(" 和 "),n("code",[t._v("$ssrContext")]),t._v("。接着又在 "),n("code",[t._v("Vue")]),t._v(" 构造函数上定义了 "),n("code",[t._v("FunctionalRenderContext")]),t._v(" 静态属性，并且 "),n("code",[t._v("FunctionalRenderContext")]),t._v(" 属性的值为来自 "),n("code",[t._v("core/vdom/create-functional-component.js")]),t._v(" 文件的 "),n("code",[t._v("FunctionalRenderContext")]),t._v("，之所以在 "),n("code",[t._v("Vue")]),t._v(" 构造函数上暴露该属性，是为了在 "),n("code",[t._v("ssr")]),t._v(" 中使用它。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("最后，在 "),n("code",[t._v("Vue")]),t._v(" 构造函数上添加了一个静态属性 "),n("code",[t._v("version")]),t._v("，存储了当前 "),n("code",[t._v("Vue")]),t._v(" 的版本值，但是这里的 "),n("code",[t._v("'__VERSION__'")]),t._v(" 是什么鬼？打开 "),n("code",[t._v("scripts/config.js")]),t._v(" 文件，找到 "),n("code",[t._v("genConfig")]),t._v(" 方法，其中有这么一句话："),n("code",[t._v("__VERSION__: version")]),t._v("。这句话被写在了 "),n("code",[t._v("rollup")]),t._v(" 的 "),n("code",[t._v("replace")]),t._v(" 插件中，也就是说，"),n("code",[t._v("__VERSION__")]),t._v(" 最终将被 "),n("code",[t._v("version")]),t._v(" 的值替换，而 "),n("code",[t._v("version")]),t._v(" 的值就是 "),n("code",[t._v("Vue")]),t._v(" 的版本号。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token function"}},[this._v("initGlobalAPI")]),s("span",{attrs:{class:"token punctuation"}},[this._v("(")]),this._v("Vue"),s("span",{attrs:{class:"token punctuation"}},[this._v(")")]),this._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("大家应该可以猜个大概，这看上去像是在 "),n("code",[t._v("Vue")]),t._v(" 上添加一些全局的API，实际上就是这样的，这些全局API以静态属性和方法的形式被添加到 "),n("code",[t._v("Vue")]),t._v(" 构造函数上，打开 "),n("code",[t._v("src/core/global-api/index.js")]),t._v(" 文件找到 "),n("code",[t._v("initGlobalAPI")]),t._v(" 方法，我们来看看 "),n("code",[t._v("initGlobalAPI")]),t._v(" 方法都做了什么。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// config")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" configDef "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  configDef"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("get")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" config\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("process"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token constant"}},[t._v("NODE_ENV")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'production'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    configDef"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("set")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{attrs:{class:"token function"}},[t._v("warn")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n        "),n("span",{attrs:{class:"token string"}},[t._v("'Do not replace the Vue.config object, set individual fields instead.'")]),t._v("\n      "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  Object"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("defineProperty")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'config'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" configDef"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("这段代码的作用是在 "),n("code",[t._v("Vue")]),t._v(" 构造函数上添加 "),n("code",[t._v("config")]),t._v(" 属性，这个属性的添加方式类似我们前面看过的 "),n("code",[t._v("$data")]),t._v(" 以及 "),n("code",[t._v("$props")]),t._v("，也是一个只读的属性，并且当你试图设置其值时，在非生产环境下会给你一个友好的提示。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("那 "),s("code",[this._v("Vue.config")]),this._v(" 的值是什么呢？在 "),s("code",[this._v("src/core/global-api/index.js")]),this._v(" 文件的开头有这样一句：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[s("span",{attrs:{class:"token keyword"}},[this._v("import")]),this._v(" config "),s("span",{attrs:{class:"token keyword"}},[this._v("from")]),this._v(" "),s("span",{attrs:{class:"token string"}},[this._v("'../config'")]),this._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("所以 "),s("code",[this._v("Vue.config")]),this._v(" 代理的是从 "),s("code",[this._v("core/config.js")]),this._v(" 文件导出的对象。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// exposed util methods.")]),t._v("\n"),n("span",{attrs:{class:"token comment"}},[t._v("// NOTE: these are not considered part of the public API - avoid relying on")]),t._v("\n"),n("span",{attrs:{class:"token comment"}},[t._v("// them unless you are aware of the risk.")]),t._v("\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("util "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\twarn"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\textend"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tmergeOptions"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tdefineReactive\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("在 "),n("code",[t._v("Vue")]),t._v(" 上添加了 "),n("code",[t._v("util")]),t._v(" 属性，这是一个对象，这个对象拥有四个属性分别是："),n("code",[t._v("warn")]),t._v("、"),n("code",[t._v("extend")]),t._v("、"),n("code",[t._v("mergeOptions")]),t._v(" 以及 "),n("code",[t._v("defineReactive")]),t._v("。这四个属性来自于 "),n("code",[t._v("core/util/index.js")]),t._v(" 文件。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("这里有一段注释，大概意思是 "),s("code",[this._v("Vue.util")]),this._v(" 以及 "),s("code",[this._v("util")]),this._v(" 下的四个方法都不被认为是公共API的一部分，要避免依赖他们，但是你依然可以使用，只不过风险你要自己控制。并且，在官方文档上也并没有介绍这个全局API，所以能不用尽量不要用。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token keyword"}},[t._v("set")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("set")]),t._v("\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token keyword"}},[t._v("delete")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" del\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("nextTick "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" nextTick\n\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Object"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("create")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("这段代码比较简单，在 "),n("code",[t._v("Vue")]),t._v(" 上添加了四个属性分别是 "),n("code",[t._v("set")]),t._v("、"),n("code",[t._v("delete")]),t._v("、"),n("code",[t._v("nextTick")]),t._v(" 以及 "),n("code",[t._v("options")]),t._v("，这里要注意的是 "),n("code",[t._v("Vue.options")]),t._v("，现在它还只是一个空的对象，通过 "),n("code",[t._v("Object.create(null)")]),t._v(" 创建。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("不过接下来，"),s("code",[this._v("Vue.options")]),this._v(" 就不是一个空的对象了，因为下面这段代码：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token constant"}},[t._v("ASSET_TYPES")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("forEach")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type "),n("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'s'")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Object"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("create")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v('// this is used to identify the "base" constructor to extend all plain-object')]),t._v("\n"),n("span",{attrs:{class:"token comment"}},[t._v("// components with in Weex's multi-instance scenarios.")]),t._v("\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_base "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Vue\n\n"),n("span",{attrs:{class:"token function"}},[t._v("extend")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("components"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" builtInComponents"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("上面的代码中，"),s("code",[this._v("ASSET_TYPES")]),this._v(" 来自于 "),s("code",[this._v("shared/constants.js")]),this._v(" 文件，打开这个文件，发现 "),s("code",[this._v("ASSET_TYPES")]),this._v(" 是一个数组：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{attrs:{class:"token constant"}},[t._v("ASSET_TYPES")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),n("span",{attrs:{class:"token string"}},[t._v("'component'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{attrs:{class:"token string"}},[t._v("'directive'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{attrs:{class:"token string"}},[t._v("'filter'")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token constant"}},[t._v("ASSET_TYPES")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("forEach")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type "),n("span",{attrs:{class:"token operator"}},[t._v("+")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'s'")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Object"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("create")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v('// this is used to identify the "base" constructor to extend all plain-object')]),t._v("\n"),n("span",{attrs:{class:"token comment"}},[t._v("// components with in Weex's multi-instance scenarios.")]),t._v("\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("_base "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Vue\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("Vue.options")]),this._v(" 将变成这样：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tcomponents"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("create")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tdirectives"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("create")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tfilters"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("create")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t_base"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Vue\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token function"}},[t._v("extend")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("components"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" builtInComponents"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" KeepAlive "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./keep-alive'")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  KeepAlive\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("所以最终 "),s("code",[this._v("Vue.options.components")]),this._v(" 的值如下：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("components "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tKeepAlive\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("那么到现在为止，"),s("code",[this._v("Vue.options")]),this._v(" 已经变成了这样：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tcomponents"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tKeepAlive\n\t"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tdirectives"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("create")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tfilters"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("create")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t_base"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Vue\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("我们继续看代码，在 "),s("code",[this._v("initGlobalAPI")]),this._v(" 方法的最后部分，以 "),s("code",[this._v("Vue")]),this._v(" 为参数调用了四个 "),s("code",[this._v("init*")]),this._v(" 方法：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token function"}},[t._v("initUse")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token function"}},[t._v("initMixin")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token function"}},[t._v("initExtend")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token function"}},[t._v("initAssetRegisters")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("这四个方法从上至下分别来自于 "),n("code",[t._v("global-api/use.js")]),t._v("、"),n("code",[t._v("global-api/mixin.js")]),t._v("、"),n("code",[t._v("global-api/extend.js")]),t._v(" 以及 "),n("code",[t._v("global-api/assets.js")]),t._v(" 这四个文件，我们不着急，一个一个慢慢的看，先打开 "),n("code",[t._v("global-api/use.js")]),t._v(" 文件，我们发现这个文件只有一个 "),n("code",[t._v("initUse")]),t._v(" 方法，如下：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("/* @flow */")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" toArray "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'../util/index'")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("initUse")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" GlobalAPI"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("use")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("plugin"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Function "),n("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Object"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("该方法的作用是在 "),s("code",[this._v("Vue")]),this._v(" 构造函数上添加 "),s("code",[this._v("use")]),this._v(" 方法，也就是传说中的 "),s("code",[this._v("Vue.use")]),this._v(" 这个全局API，这个方法大家应该不会陌生，用来安装 Vue 插件。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("再打开 "),s("code",[this._v("global-api/mixin.js")]),this._v(" 文件，这个文件更简单，全部代码如下：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("/* @flow */")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" mergeOptions "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'../util/index'")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("initMixin")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" GlobalAPI"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("mixin")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("mixin"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("mergeOptions")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" mixin"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("其中，"),s("code",[this._v("initMixin")]),this._v(" 方法的作用是，在 "),s("code",[this._v("Vue")]),this._v(" 上添加 "),s("code",[this._v("mixin")]),this._v(" 这个全局API。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("再打开 "),s("code",[this._v("global-api/extend.js")]),this._v(" 文件，找到 "),s("code",[this._v("initExtend")]),this._v(" 方法，如下：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("initExtend")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" GlobalAPI"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v('/**\n   * Each instance constructor, including Vue, has a unique\n   * cid. This enables us to create wrapped "child\n   * constructors" for prototypal inheritance and cache them.\n   */')]),t._v("\n  Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cid "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("0")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("let")]),t._v(" cid "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token number"}},[t._v("1")]),t._v("\n\n  "),n("span",{attrs:{class:"token comment"}},[t._v("/**\n   * Class inheritance\n   */")]),t._v("\n  Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("extend")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("extendOptions"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Function "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token comment"}},[t._v("// ...")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[n("code",[t._v("initExtend")]),t._v(" 方法在 "),n("code",[t._v("Vue")]),t._v(" 上添加了 "),n("code",[t._v("Vue.cid")]),t._v(" 静态属性，和 "),n("code",[t._v("Vue.extend")]),t._v(" 静态方法。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("最后一个是 "),s("code",[this._v("initAssetRegisters")]),this._v("，我们打开 "),s("code",[this._v("global-api/assets.js")]),this._v(" 文件，找到 "),s("code",[this._v("initAssetRegisters")]),this._v(" 方法如下：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("initAssetRegisters")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" GlobalAPI"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("/**\n   * Create asset registration methods.\n   */")]),t._v("\n  "),n("span",{attrs:{class:"token constant"}},[t._v("ASSET_TYPES")]),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("forEach")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("type "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("type"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n      id"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n      definition"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Function "),n("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Object\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Function "),n("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Object "),n("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("void")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n      "),n("span",{attrs:{class:"token comment"}},[t._v("// ......")]),t._v("\n    "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("其中，"),s("code",[this._v("ASSET_TYPES")]),this._v(" 我们已经见过了，它在 "),s("code",[this._v("shared/constants.js")]),this._v(" 文件中，长成这样：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" "),n("span",{attrs:{class:"token constant"}},[t._v("ASSET_TYPES")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),t._v("\n  "),n("span",{attrs:{class:"token string"}},[t._v("'component'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{attrs:{class:"token string"}},[t._v("'directive'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  "),n("span",{attrs:{class:"token string"}},[t._v("'filter'")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("所以，最终经过 "),s("code",[this._v("initAssetRegisters")]),this._v(" 方法，"),s("code",[this._v("Vue")]),this._v(" 将又多了三个静态方法：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("pre",{pre:!0,attrs:{class:"language-js"}},[s("code",[this._v("Vue"),s("span",{attrs:{class:"token punctuation"}},[this._v(".")]),this._v("component\nVue"),s("span",{attrs:{class:"token punctuation"}},[this._v(".")]),this._v("directive\nVue"),s("span",{attrs:{class:"token punctuation"}},[this._v(".")]),this._v("filter\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("至此，对于 "),n("code",[t._v("core/index.js")]),t._v(" 文件的作用我们也大概清楚了，在这个文件里，它首先将核心的 "),n("code",[t._v("Vue")]),t._v("，也就是在 "),n("code",[t._v("core/instance/index.js")]),t._v(" 文件中的 "),n("code",[t._v("Vue")]),t._v("，也可以说是原型被包装(添加属性和方法)后的 "),n("code",[t._v("Vue")]),t._v(" 导出，然后使用 "),n("code",[t._v("initGlobalAPI")]),t._v(" 方法给 "),n("code",[t._v("Vue")]),t._v(" 添加静态方法和属性，除此之外，在这里文件里，也对原型进行了修改，为其添加了两个属性："),n("code",[t._v("$isServer")]),t._v(" 和 "),n("code",[t._v("$ssrContext")]),t._v("，最后添加了 "),n("code",[t._v("Vue.version")]),t._v(" 属性并导出了 "),n("code",[t._v("Vue")]),t._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"vue-平台化的包装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vue-平台化的包装","aria-hidden":"true"}},[this._v("#")]),this._v(" Vue 平台化的包装")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("现在，在我们弄清 "),n("code",[t._v("Vue")]),t._v(" 构造函数的过程中已经看了两个主要的文件，分别是："),n("code",[t._v("core/instance/index.js")]),t._v(" 文件以及 "),n("code",[t._v("core/index.js")]),t._v(" 文件，前者是 "),n("code",[t._v("Vue")]),t._v(" 构造函数的定义文件，我们一直都叫其 "),n("code",[t._v("Vue")]),t._v(" 的出生文件，主要作用是定义 "),n("code",[t._v("Vue")]),t._v(" 构造函数，并对其原型添加属性和方法，即实例属性和实例方法。后者的主要作用是，为 "),n("code",[t._v("Vue")]),t._v(" 添加全局的API，也就是静态的方法和属性。这两个文件有个共同点，就是它们都在 "),n("code",[t._v("core")]),t._v(" 目录下，我们在介绍 "),n("code",[t._v("Vue")]),t._v(" 项目目录结构的时候说过："),n("code",[t._v("core")]),t._v(" 目录存放的是平台无关的代码，所以无论是 "),n("code",[t._v("core/instance/index.js")]),t._v(" 文件还是 "),n("code",[t._v("core/index.js")]),t._v(" 文件，它们都在包装核心的 "),n("code",[t._v("Vue")]),t._v("，且这些包装是平台无关的。但是，"),n("code",[t._v("Vue")]),t._v(" 是一个 "),n("code",[t._v("Multi-platform")]),t._v(" 的项目（web和weex），不同平台可能会内置不同的组件、指令，或者一些平台特有的功能等等，那么这就需要对 "),n("code",[t._v("Vue")]),t._v(" 根据不同的平台进行平台化的包装，这就是接下来我们要看的文件，这个文件也出现在我们寻找 "),n("code",[t._v("Vue")]),t._v(" 构造函数的路线上，他就是："),n("code",[t._v("platforms/web/runtime/index.js")]),t._v(" 文件。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("在看这个文件之前，大家可以先打开 "),n("code",[t._v("platforms")]),t._v(" 目录，可以发现有两个子目录 "),n("code",[t._v("web")]),t._v(" 和 "),n("code",[t._v("weex")]),t._v("。这两个子目录的作用就是分别为相应的平台对核心的 "),n("code",[t._v("Vue")]),t._v(" 进行包装的。而我们所要研究的 web 平台，就在 "),n("code",[t._v("web")]),t._v(" 这个目录里。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("接下来，我们就打开 "),n("code",[t._v("platforms/web/runtime/index.js")]),t._v(" 文件，看一看里面的代码，这个文件的一开始，是一大堆 "),n("code",[t._v("import")]),t._v(" 语句，其中就包括从 "),n("code",[t._v("core/index.js")]),t._v(" 文件导入 "),n("code",[t._v("Vue")]),t._v(" 的那句。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("在 "),s("code",[this._v("import")]),this._v(" 语句下面是这样一段代码：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// install platform specific utils")]),t._v("\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mustUseProp "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" mustUseProp\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isReservedTag "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" isReservedTag\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isReservedAttr "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" isReservedAttr\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("getTagNamespace "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" getTagNamespace\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isUnknownElement "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" isUnknownElement\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("大家还记得 "),s("code",[this._v("Vue.config")]),this._v(" 吗？其代理的值是从 "),s("code",[this._v("core/config.js")]),this._v(" 文件导出的对象，这个对象最开始长成这样：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  optionMergeStrategies"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("create")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  silent"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token boolean"}},[t._v("false")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  productionTip"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" process"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token constant"}},[t._v("NODE_ENV")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'production'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  devtools"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" process"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("env"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token constant"}},[t._v("NODE_ENV")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("!==")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'production'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  performance"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token boolean"}},[t._v("false")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  errorHandler"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  warnHandler"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  ignoredElements"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("[")]),n("span",{attrs:{class:"token punctuation"}},[t._v("]")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  keyCodes"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("create")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  isReservedTag"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" no"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  isReservedAttr"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" no"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  isUnknownElement"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" no"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  getTagNamespace"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" noop"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  parsePlatformTagName"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" identity"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  mustUseProp"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" no"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  _lifecycleHooks"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token constant"}},[t._v("LIFECYCLE_HOOKS")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("我们可以看到，从 "),s("code",[this._v("core/config.js")]),this._v(" 文件导出的 "),s("code",[this._v("config")]),this._v(" 对象，大部分都是初始化了一个初始值，并且我们在 "),s("code",[this._v("core/config.js")]),this._v(" 文件中能看到很多这样的注释，如下图：")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("img",{attrs:{src:"http://ovjvjtt4l.bkt.clouddn.com/2017-09-06-090635.jpg",alt:""}})])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[s("code",[this._v("This is platform-dependent and may be overwritten.")]),this._v("，这句话的意思是，这个配置的是与平台有关的，很可能被覆盖掉。这个时候我们在回看这段代码：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// install platform specific utils")]),t._v("\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("mustUseProp "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" mustUseProp\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isReservedTag "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" isReservedTag\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isReservedAttr "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" isReservedAttr\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("getTagNamespace "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" getTagNamespace\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("config"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("isUnknownElement "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" isUnknownElement\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("其实这就是在覆盖默认导出的 "),s("code",[this._v("config")]),this._v(" 对象的属性，注释已经写得很清楚了，安装平台特定的工具方法，至于这些东西的作用这里我们暂且不说，你只要知道它在干嘛即可。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// install platform runtime directives & components")]),t._v("\n"),n("span",{attrs:{class:"token function"}},[t._v("extend")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("directives"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" platformDirectives"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token function"}},[t._v("extend")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("components"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" platformComponents"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("安装特定平台运行时的指令和组件，大家还记得 "),s("code",[this._v("Vue.options")]),this._v(" 长什么样吗？在执行这两句代码之前，它长成这样：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tcomponents"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tKeepAlive\n\t"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tdirectives"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("create")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tfilters"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("create")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t_base"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Vue\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("根据文件开头的 "),s("code",[this._v("import")]),this._v(" 语句：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" platformDirectives "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./directives/index'")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" platformComponents "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./components/index'")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("我们知道，这两个变量来自于 "),s("code",[this._v("runtime/directives/index.js")]),this._v(" 文件和 "),s("code",[this._v("runtime/components/index.js")]),this._v(" 文件，我们先打开 "),s("code",[this._v("runtime/directives/index.js")]),this._v(" 文件，下面是其全部代码：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" model "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./model'")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" show "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./show'")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  model"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  show\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("也就是说，"),s("code",[this._v("platformDirectives")]),this._v(" 是：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("platformDirectives "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  model"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  show\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token function"}},[t._v("extend")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("directives"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" platformDirectives"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("这句代码之后，"),s("code",[this._v("Vue.options")]),this._v(" 将变为：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tcomponents"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tKeepAlive\n\t"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tdirectives"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tmodel"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\tshow\n\t"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tfilters"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("create")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t_base"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Vue\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("同样的道理，下面是 "),s("code",[this._v("runtime/components/index.js")]),this._v(" 文件全部的代码：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Transition "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./transition'")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" TransitionGroup "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./transition-group'")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  Transition"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  TransitionGroup\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("所以 "),s("code",[this._v("platformComponents")]),this._v(" 的值为：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("platformComponents "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  Transition"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  TransitionGroup\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token function"}},[t._v("extend")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("components"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" platformComponents"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("之后，"),s("code",[this._v("Vue.options")]),this._v(" 将变为：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("options "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\tcomponents"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tKeepAlive"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\tTransition"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\tTransitionGroup\n\t"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tdirectives"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n\t\tmodel"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t\tshow\n\t"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\tfilters"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Object"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("create")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("null")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n\t_base"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Vue\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("这样，这两句代码的目的我们就搞清楚了，其作用是在 "),s("code",[this._v("Vue.options")]),this._v(" 上添加 "),s("code",[this._v("web")]),this._v(" 平台运行时的特定组件和指令。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// install platform patch function")]),t._v("\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("__patch__ "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" inBrowser "),n("span",{attrs:{class:"token operator"}},[t._v("?")]),t._v(" patch "),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" noop\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("// public mount method")]),t._v("\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("$mount")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  el"),n("span",{attrs:{class:"token operator"}},[t._v("?")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string "),n("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Element"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  hydrating"),n("span",{attrs:{class:"token operator"}},[t._v("?")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" boolean\n"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Component "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  el "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" el "),n("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" inBrowser "),n("span",{attrs:{class:"token operator"}},[t._v("?")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("query")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" undefined\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("mountComponent")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token keyword"}},[t._v("this")]),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" el"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" hydrating"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("首先在 "),n("code",[t._v("Vue.prototype")]),t._v(" 上添加 "),n("code",[t._v("__patch__")]),t._v(" 方法，如果在浏览器环境运行的话，这个方法的值为 "),n("code",[t._v("patch")]),t._v(" 函数，否则是一个空函数 "),n("code",[t._v("noop")]),t._v("。然后又在 "),n("code",[t._v("Vue.prototype")]),t._v(" 上添加了 "),n("code",[t._v("$mount")]),t._v(" 方法，我们暂且不关心 "),n("code",[t._v("$mount")]),t._v(" 方法的内容和作用。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("再往下的一段代码是 "),s("code",[this._v("vue-devtools")]),this._v(" 的全局钩子，它被包裹在 "),s("code",[this._v("setTimeout")]),this._v(" 中，最后导出了 "),s("code",[this._v("Vue")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("现在我们就看完了 "),s("code",[this._v("platforms/web/runtime/index.js")]),this._v(" 文件，该文件的作用是对 "),s("code",[this._v("Vue")]),this._v(" 进行平台化的包装：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ul",[n("li",[t._v("设置平台化的 "),n("code",[t._v("Vue.config")]),t._v("。")]),n("li",[t._v("在 "),n("code",[t._v("Vue.options")]),t._v(" 上混合了两个指令("),n("code",[t._v("directives")]),t._v(")，分别是 "),n("code",[t._v("model")]),t._v(" 和 "),n("code",[t._v("show")]),t._v("。")]),n("li",[t._v("在 "),n("code",[t._v("Vue.options")]),t._v(" 上混合了两个组件("),n("code",[t._v("components")]),t._v(")，分别是 "),n("code",[t._v("Transition")]),t._v(" 和 "),n("code",[t._v("TransitionGroup")]),t._v("。")]),n("li",[t._v("在 "),n("code",[t._v("Vue.prototype")]),t._v(" 上添加了两个方法："),n("code",[t._v("__patch__")]),t._v(" 和 "),n("code",[t._v("$mount")]),t._v("。")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("在经过这个文件之后，"),n("code",[t._v("Vue.options")]),t._v(" 以及 "),n("code",[t._v("Vue.config")]),t._v(" 和 "),n("code",[t._v("Vue.prototype")]),t._v(" 都有所变化，我们把这些变化更新到对应的 "),n("code",[t._v("附录")]),t._v(" 文件里，都可以查看的到。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("h2",{attrs:{id:"with-compiler"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#with-compiler","aria-hidden":"true"}},[this._v("#")]),this._v(" with compiler")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("在看完 "),n("code",[t._v("runtime/index.js")]),t._v(" 文件之后，其实 "),n("code",[t._v("运行时")]),t._v(" 版本的 "),n("code",[t._v("Vue")]),t._v(" 构造函数就已经“成型了”。我们可以打开 "),n("code",[t._v("entry-runtime.js")]),t._v(" 这个入口文件，这个文件只有两行代码：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Vue "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./runtime/index'")]),t._v("\n\n"),n("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v(" Vue\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("可以发现，"),n("code",[t._v("运行时")]),t._v(" 的入口文件，导出的 "),n("code",[t._v("Vue")]),t._v(" 就到 "),n("code",[t._v("./runtime/index.js")]),t._v(" 文件为止。然而我们所选择的并不仅仅是运行时，而是完整版的 "),n("code",[t._v("Vue")]),t._v("，入口文件是 "),n("code",[t._v("entry-runtime-with-compiler.js")]),t._v("，我们知道完整版和运行时版的区别就在于 "),n("code",[t._v("compiler")]),t._v("，所以其实在我们看这个文件的代码之前也能够知道这个文件的作用："),n("em",[t._v("就是在运行时的基础上添加 "),n("code",[t._v("compiler")])]),t._v("，对没错，这个文件就是干这个的，接下来我们就看看它是怎么做的，打开 "),n("code",[t._v("entry-runtime-with-compiler.js")]),t._v(" 文件：")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{attrs:{class:"token comment"}},[t._v("// ... 其他 import 语句")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("// 导入 运行时 的 Vue")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" Vue "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./runtime/index'")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("// ... 其他 import 语句")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("// 从 ./compiler/index.js 文件导入 compileToFunctions")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("import")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v(" compileToFunctions "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("from")]),t._v(" "),n("span",{attrs:{class:"token string"}},[t._v("'./compiler/index'")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("// 根据 id 获取元素的 innerHTML")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" idToTemplate "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("cached")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id "),n("span",{attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" el "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("query")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("id"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" el "),n("span",{attrs:{class:"token operator"}},[t._v("&&")]),t._v(" el"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerHTML\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("// 使用 mount 变量缓存 Vue.prototype.$mount 方法")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" mount "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" Vue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("$mount\n"),n("span",{attrs:{class:"token comment"}},[t._v("// 重写 Vue.prototype.$mount 方法")]),t._v("\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("prototype"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function-variable function"}},[t._v("$mount")]),t._v(" "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("\n  el"),n("span",{attrs:{class:"token operator"}},[t._v("?")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string "),n("span",{attrs:{class:"token operator"}},[t._v("|")]),t._v(" Element"),n("span",{attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n  hydrating"),n("span",{attrs:{class:"token operator"}},[t._v("?")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" boolean\n"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Component "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token comment"}},[t._v("// ... 函数体省略")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("/**\n * 获取元素的 outerHTML\n */")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{attrs:{class:"token function"}},[t._v("getOuterHTML")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" Element"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(":")]),t._v(" string "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{attrs:{class:"token keyword"}},[t._v("if")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("outerHTML"),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" el"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("outerHTML\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("else")]),t._v(" "),n("span",{attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("const")]),t._v(" container "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" document"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("createElement")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token string"}},[t._v("'div'")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    container"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("appendChild")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),t._v("el"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{attrs:{class:"token function"}},[t._v("cloneNode")]),n("span",{attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{attrs:{class:"token boolean"}},[t._v("true")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),n("span",{attrs:{class:"token keyword"}},[t._v("return")]),t._v(" container"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("innerHTML\n  "),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),n("span",{attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("// 在 Vue 上添加一个全局API `Vue.compile` 其值为上面导入进来的 compileToFunctions")]),t._v("\nVue"),n("span",{attrs:{class:"token punctuation"}},[t._v(".")]),t._v("compile "),n("span",{attrs:{class:"token operator"}},[t._v("=")]),t._v(" compileToFunctions\n\n"),n("span",{attrs:{class:"token comment"}},[t._v("// 导出 Vue")]),t._v("\n"),n("span",{attrs:{class:"token keyword"}},[t._v("export")]),t._v(" "),n("span",{attrs:{class:"token keyword"}},[t._v("default")]),t._v(" Vue\n")])])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("上面代码是简化过的，但是保留了所有重要的部分，该文件的开始是一堆 "),n("code",[t._v("import")]),t._v(" 语句，其中重要的两句 "),n("code",[t._v("import")]),t._v(" 语句就是上面代码中出现的那两句，一句是导入运行时的 "),n("code",[t._v("Vue")]),t._v("，一句是从 "),n("code",[t._v("./compiler/index.js")]),t._v(" 文件导入 "),n("code",[t._v("compileToFunctions")]),t._v("，并且在倒数第二句代码将其添加到 "),n("code",[t._v("Vue.compile")]),t._v(" 上。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("然后定义了一个函数 "),s("code",[this._v("idToTemplate")]),this._v("，这个函数的作用是：获取拥有指定 "),s("code",[this._v("id")]),this._v(" 属性的元素的 "),s("code",[this._v("innerHTML")]),this._v("。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("之后缓存了运行时Vue的 "),s("code",[this._v("Vue.prototype.$mount")]),this._v(" 方法，并且进行了重写。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("接下来又定义了 "),s("code",[this._v("getOuterHTML")]),this._v(" 函数，用来获取一个元素的 "),s("code",[this._v("outerHTML")]),this._v("。")])},function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("p",[t._v("这个文件运行下来，对 "),n("code",[t._v("Vue")]),t._v(" 的影响有两个，第一个影响是它重写了 "),n("code",[t._v("Vue.prototype.$mount")]),t._v(" 方法；第二个影响是添加了 "),n("code",[t._v("Vue.compile")]),t._v(" 全局API，目前我们只需要获取这些信息就足够了，我们把这些影响同样更新到 "),n("code",[t._v("附录")]),t._v(" 对应的文件中，也都可以查看的到。")])},function(){var t=this.$createElement,s=this._self._c||t;return s("p",[this._v("到这里，"),s("code",[this._v("Vue")]),this._v(" 神秘面具下真实的样子基本已经展现出来了。现在深呼吸，继续我们的探索吧！")])}],!1,null,null,null);s.default=e.exports}}]);